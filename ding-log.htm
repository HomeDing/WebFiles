<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Log output</title>
  <link Content-Type="text/css" href="/iotstyle.css" rel="stylesheet" />

  <script src="micro.js"></script>
  <script src="ding.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script> -->
  <script src="es6-promise.auto.js"></script>
  <script src="polyfill.js"></script>
  <style>
    html,
    body {
      height: 100%;
    }

    pre.code {
      display: block;
      margin: 0;
      border: solid 1px black;
      padding: 0.2em;
      font-family: Courier New, Courier, monospace;
      font-size: 0.75rem;
      line-height: 1.2;
      color: black;
      background-color: #fffff8;
      overflow-x: hidden;
      overflow-y: scroll;
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body style="height:100%;">
  <div class="container-fluid" style="display:flex;flex-direction:column;height:100%;overflow:hidden">
    <div class="u-header">
      <a href="/" title="Startpage" ><img class="icon" src="/favicon.svg" /></a>
      <h1>Log output</h1>
      <a href="/ding-ide.htm" title="Start IDE"><img class="icon" src="/i/ide.svg" /><span class="hidden-xs">IDE</span></a>
      <a href="/ding-info.htm" title="Start Config"><img class="icon" src="/i/config.svg" /><span class="hidden-xs">Config</span></a>
      <a href="/ding-log.htm" title="Logfile"><img class="icon" src="/i/log.svg" /><span class="hidden-xs">Log</span></a>
    </div>

    <!-- <div class="u-navbar">
      <button id="addButton">+</button>
    </div> -->

    <div class="row " style="flex:1 1 auto;margin-bottom:0;overflow:hidden">
      <div class="col stretch" style="align-self:stretch;overflow:hidden">
        <pre class="code" id="logtext"></pre>
      </div>
    </div>
  </div>

  <script>
    var logTextObj = document.getElementById('logtext');
    var lastText = "";

    function appendLog(logtext) {
      var newText = logtext;
      if (logtext == lastText) {
        return;
      } else if ((lastText.length > 0) && (logtext.lastIndexOf(lastText, 0) === 0)) {
        newText = logtext.substr(lastText.length);
      }
      lastText = logtext;

      logTextObj.insertAdjacentText('beforeend', newText);
      logTextObj.scrollTop = logTextObj.scrollHeight;
    }

    fetch('/log_old.txt')
      .then(function (result) {
        return (result.text());
      }).then(function (txt) {
        appendLog(txt);
        return (fetch('/log.txt'));
      }).then(function (result) {
        return (result.text());
      }).then(function (txt) {
        appendLog(txt);
      });

    function updateLog() {
      fetch('/log.txt')
        .then(function (result) {
          return (result.text())
        }).then(function (txt) {
          appendLog(txt);
        });
    }

    window.setInterval(updateLog, 1000);
  </script>

</body>

</html>