function toBool(s){if(!s)return false;switch(s.toLowerCase().trim()){case"true":case"yes":return true;case"false":case"no":case"0":case null:return false;default:return Boolean(s)}}function dispatch(id,prop,val){if(val!=null){var url="/$board"+id+"?"+prop+"="+val;fetch(url)}}function jsonParse(obj,cbFunc){function _jsonParse(path,key,value,cbFunc){var path2=key?path+"/"+key:path;path2=path2.replace("/[","[");if(Array.isArray(value)){for(var n=0;n<value.length;n++){_jsonParse(path2,"["+n+"]",value[n],cbFunc)}}else if(typeof value=="object"){cbFunc(path2,null,null);for(n in value){_jsonParse(path2,n,value[n],cbFunc)}}else{cbFunc(path,key,String(value))}}_jsonParse("","",obj,cbFunc)}var MicroHub=function(){this._registrations={};this._registrationsId=0;this.subscribe=function(matchPath,callback){var h=this._registrationsId;var rn=matchPath.toLocaleLowerCase();rn="^"+rn.replace(/(\[|\]|\/|\?)/g,"\\$1").replace(/\*\*/g,"\\S{0,}").replace(/\*/g,"[^/?]*")+"$";var newEntry={id:h,match:rn,callback:callback};this._registrations[h]=newEntry;this._registrationsId++;return h};this.unsubscribe=function(h){this._registrations[h]=null};this.publishObj=function(obj){var _this=this;jsonParse(obj,function(path,key,value){_this.publishValue(path,key?key.toLowerCase():null,value)})};this.publishValue=function(path,key,value){var fullPath=path+(key?"?"+key:"");if(fullPath){fullPath=fullPath.toLocaleLowerCase();for(var h in this._registrations){var r=this._registrations[h];if(r&&fullPath.match(r.match)){r.callback.call(r.scope,path,key,value)}}}};this.onunload=function(evt){for(var n in this._registrations){this._registrations[n].callback=null;this._registrations[n]=null}}};var hub=new MicroHub;window.addEventListener("unload",hub.onunload.bind(hub),false);var MicroJCL=function(){this._tco;this._templates={};this._behaviors={};this.List=[];this.init=function(){this._tco=document.getElementById("u-templates");if(!this._tco){var t=document.createElement("div");t.id="u-templates";this._tco=document.body.appendChild(t)}};this.loadFile=function(fName){var scope=this;var ret=fetch(fName).then(function(result){return result.text()}).then(function(html){scope._tco.insertAdjacentHTML("beforeend",html)});return ret};this.attach=function(obj){var mb=obj.getAttribute("microbehavior");var bc=this._behaviors[mb];if(mb&&bc){this.LoadBehaviour(obj,bc)}};this.attachAll=function(root){this.attach(root);root.querySelectorAll("[microbehavior]").forEach(this.attach.bind(this))};this.setProperties=function(obj,props){if(obj.nodeType==3){var v=obj.textContent;for(var p in props){v=v.replace(new RegExp("\\$\\{"+p+"\\}","g"),props[p])}obj.textContent=v;return}for(var i=0;i<obj.attributes.length;i++){var n=obj.attributes[i].name;var v=obj.attributes[i].value;if(v.indexOf("${")>=0){for(var p in props){v=v.replace(new RegExp("\\$\\{"+p+"\\}","g"),props[p])}obj[n]=obj.attributes[i].value=v}}var n=obj.firstChild;while(n){this.setProperties(n,props);n=n.nextSibling}};this.insertTemplate=function(root,controlName,props){var e=null;if(root&&controlName){var te=this._tco.querySelector('[microcontrol="'+controlName+'"]');if(te)e=te.cloneNode(true);if(e){this.setProperties(e,props);root.appendChild(e);this.attachAll(e)}}return e};this.LoadBehaviour=function(obj,behaviour){if(obj==null){alert("LoadBehaviour: obj argument is missing.")}else if(behaviour==null){alert("LoadBehaviour: behaviour argument is missing.")}else{if(behaviour.inheritFrom){jcl.LoadBehaviour(obj,behaviour.inheritFrom);jcl.List.pop()}if(obj.attributes){for(var n=0;n<obj.attributes.length;n++)if(obj[obj.attributes[n].name]==null)obj[obj.attributes[n].name]=obj.attributes[n].value}for(var p in behaviour){if(p.substr(0,2)=="on"){obj.addEventListener(p.substr(2),behaviour[p].bind(obj),false)}else if(behaviour[p]==null||behaviour[p].constructor!=Function){if(obj[p]==null)obj[p]=behaviour[p]}else{obj[p]=behaviour[p]}}obj._attachedBehaviour=behaviour;obj.init();this.List.push(obj)}};this.FindBehaviourElement=function(obj){while(obj&&obj._attachedBehaviour==null)obj=obj.parentNode;return obj};this.registerBehaviour=function(microType,microBehavior){this._behaviors[microType]=microBehavior};this.onunload=function(evt){for(var n in this.List){var obj=this.List[n];if(obj&&obj.term)obj.term();for(var a=0;a<obj.attributes.length;a++)obj[obj.attributes[a].name]=null}for(var n in this.List){this.List[n]=null}};window.addEventListener("load",this.init.bind(this))};var jcl=new MicroJCL;window.addEventListener("unload",jcl.onunload.bind(jcl),false);function getHashParams(defaults){var params={};for(var p in defaults)params[p]=defaults[p];window.location.hash.substr(1).split("&").forEach(function(p){var pa=p.split("=");params[pa[0]]=pa[1]});return params}