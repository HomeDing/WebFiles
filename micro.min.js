function loadAsync(url,mime,loadCallback,errorCallback){var objHTTP=new XMLHttpRequest;objHTTP.open("GET",url,true);if(mime)objHTTP.overrideMimeType(mime);objHTTP.addEventListener("readystatechange",function(p){if(objHTTP.readyState==4){if(objHTTP.status>=200&&objHTTP.status<300){loadCallback(objHTTP.responseText)}else{if(errorCallback)errorCallback(this)}}});objHTTP.send()}function dispatch(id,prop,val){var url="/$board"+id+"?"+prop+"="+val;loadAsync(url,null,function(txt){},function(txt){})}function jsonParse(obj,cbFunc){function _jsonParse(path,key,value,cbFunc){var path2=key?path+"/"+key:path;path2=path2.replace("/[","[");if(Array.isArray(value)){for(var n=0;n<value.length;n++){_jsonParse(path2,"["+n+"]",value[n],cbFunc)}}else if(typeof value=="object"){cbFunc(path2,null,null);for(n in value){_jsonParse(path2,n,value[n],cbFunc)}}else{cbFunc(path,key,String(value))}}_jsonParse("","",obj,cbFunc)}var MicroHub=function(){this._registrations={};this._registrationsId=0;this.subscribe=function(matchPath,callback){var h=this._registrationsId;var rn=matchPath.toLocaleLowerCase();rn="^"+rn.replace(/(\[|\]|\/|\?)/g,"\\$1").replace(/\*\*/g,"\\S{0,}").replace(/\*/g,"[^/?]*")+"$";console.log(matchPath,rn);var newEntry={id:h,match:rn,callback:callback};this._registrations[h]=newEntry;this._registrationsId++;return h};this.unsubscribe=function(h){this._registrations[h]=null};this.publishObj=function(obj){var _this=this;jsonParse(obj,function(path,key,value){_this.publishValue(path,key?key.toLowerCase():null,value)})};this.publishValue=function(path,key,value){var fullPath=path+(key?"?"+key:"");if(fullPath){fullPath=fullPath.toLocaleLowerCase();for(var h in this._registrations){var r=this._registrations[h];if(r&&fullPath.match(r.match)){r.callback.call(r.scope,path,key,value)}}}};this.onunload=function(evt){for(var n in this._registrations){this._registrations[n].callback=null;this._registrations[n]=null}}};var hub=new MicroHub;window.addEventListener("unload",hub.onunload.bind(hub),false);var MicroJCL=function(){this._templates={};this._behaviors={};this.List=[];this.loadTemplates=function(rootObj){var all=rootObj.querySelectorAll("[microcontrol]");for(var n=0;n<all.length;n++){var t=all[n].getAttribute("microcontrol");this._templates[t]=all[n]}};this.attachAll=function(root){var elems=root.querySelectorAll("[microbehavior]");for(var n=0;n<elems.length;n++){var mb=elems[n].getAttribute("microbehavior");var bc=this._behaviors[mb];if(bc)this.LoadBehaviour(elems[n],bc)}};this.setProperties=function(obj,props){if(obj.nodeType==3){var v=obj.textContent;for(var p in props){v=v.replace(new RegExp("\\$\\{"+p+"\\}","g"),props[p])}obj.textContent=v;return}for(var i=0;i<obj.attributes.length;i++){var n=obj.attributes[i].name;var v=obj.attributes[i].value;if(v.indexOf("${")>=0){for(var p in props){v=v.replace(new RegExp("\\$\\{"+p+"\\}","g"),props[p])}obj[n]=obj.attributes[i].value=v}}var n=obj.firstChild;while(n){this.setProperties(n,props);n=n.nextSibling}};this.insertTemplate=function(root,controlName,props){var e=null;if(root&&controlName){var te=this._templates[controlName];if(te)e=te.cloneNode(true);if(e){this.setProperties(e,props);root.appendChild(e);this.attachAll(e)}}return e};this.LoadBehaviour=function(obj,behaviour){if(obj==null){alert("LoadBehaviour: obj argument is missing.")}else if(behaviour==null){alert("LoadBehaviour: behaviour argument is missing.")}else{if(behaviour.inheritFrom){jcl.LoadBehaviour(obj,behaviour.inheritFrom);jcl.List.pop()}if(obj.attributes){for(var n=0;n<obj.attributes.length;n++)if(obj[obj.attributes[n].name]==null)obj[obj.attributes[n].name]=obj.attributes[n].value}for(var p in behaviour){if(p.substr(0,2)=="on"){obj.addEventListener(p.substr(2),behaviour[p].bind(obj),false)}else if(behaviour[p]==null||behaviour[p].constructor!=Function){if(obj[p]==null)obj[p]=behaviour[p]}else{obj[p]=behaviour[p]}}obj._attachedBehaviour=behaviour;obj.init();this.List.push(obj)}};this.FindBehaviourElement=function(obj){while(obj&&obj._attachedBehaviour==null)obj=obj.parentNode;return obj};this.registerBehaviour=function(microType,microBehavior){this._behaviors[microType]=microBehavior};this.onunload=function(evt){for(var n in this.List){var obj=this.List[n];if(obj&&obj.term)obj.term();for(var a=0;a<obj.attributes.length;a++)obj[obj.attributes[a].name]=null}for(var n in this.List){this.List[n]=null}}};var jcl=new MicroJCL;window.addEventListener("unload",jcl.onunload.bind(jcl),false);function forAllNodeList(nodeList,callbackFn){for(var n=0;n<nodeList.length;n++){callbackFn(nodeList[n])}}var MicroTQ=new function(){this._queue=[];this._tHandle=null;this.startTask=function(func){this._queue.push(func);if(!this._tHandle){this._tHandle=window.setTimeout(this.nextTask.bind(this),1)}};this.nextTask=function(){this._tHandle=null;if(this._queue.length>0){var func=this._queue.shift();func()}if(!this._tHandle&&this._queue.length>0){this._tHandle=window.setTimeout(this.nextTask.bind(this),1)}};this.clear=function(){this._queue=[]}};