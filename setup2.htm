<!DOCTYPE html>
<html lang="en">

<head>
  <title>HomeDing Setup</title>
  <style>
    * {
      font-family: sans-serif;
      box-sizing: border-box;
    }

    #carousel {
      position: relative;
      display: flex;
      width: 400px;
      height: 300px;
      background-color: lime;
      overflow: hidden;
    }

    #carousel .item {
      position: absolute;
      width: 400px;
      height: 300px;
      left: 0px;
      background-color: azure;
      flex: 0 0 auto;
      transition: left 0.6s;
      overflow: hidden;
    }

    #carousel .item.hide {
      left: 400px;
    }
  </style>
</head>

<body>
  <h1>HomeDing Setup</h1>
  <button onclick="cShow(0)">(0)</button>
  <button onclick="cShow(1)">(1)</button>
  <button onclick="cShow(2)">(2)</button>
  <hr>
  <div id='carousel'>
    <div class="item">
      <h2>Connect to network</h2>
      <table>
        <tr>
          <td>Network:</td>
          <td><select id="conNetworks" style="width:18em"></select></td>
        </tr>
        <tr>
          <td>Passphrase:</td>
          <td><input id="conPass" style="width:18em"></input></td>
        </tr>
      </table>
      <button id="connectPass">Connect</button>
    </div>
    <div class="item">
      <h2>Update WebUI</h2>
      <p>Here some text</p>
    </div>
    <div class="item">
      <h2>Upload Files</h2>
      <p>Here some text</p>
    </div>
  </div>

  <script>
    var scanDone = 2;
    var checkTimer = 0;
    var selObj = document.getElementById("conNetworks");
    var next2Obj = document.getElementById("next2");

    function load(url, loadCallback) {
      var objHTTP = new XMLHttpRequest();
      objHTTP.open("GET", url, true);
      objHTTP.addEventListener("readystatechange", function (p) {
        if (objHTTP.readyState == 4) {
          if ((objHTTP.status >= 200) && (objHTTP.status < 300)) {
            loadCallback(objHTTP.responseText);
          } // if
        } // if
      });
      objHTTP.send();
    } // load()

    function startScan() {
      if (scanDone == 2) {
        selObj.innerHTML = "<option selected disabled>scanning...</option>";
        scanDone = 0;
        if (!checkTimer)
          checkTimer = window.setInterval(checkScan, 200);
      }
    } // startScan()

    function checkScan() {
      load('/$scan', function (txt) {
        if (txt.length > 0) {
          scanDone = 2;
          scanResult(JSON.parse(txt));
        }
      });
    } // checkScan()

    function scanResult(netList) {
      window.clearInterval(checkTimer);
      checkTimer = 0;

      selObj.innerHTML = "";

      var o = document.createElement('option');
      o.value = 0;
      o.text = "select...";
      o.disabled = true;
      selObj.options.add(o);

      netList.forEach(function (n) {
        var o = document.createElement('option');
        o.value = o.text = n.id;
        selObj.options.add(o);
      });
    } // scanResult()

    // connect using network name and password
    document.getElementById("connectPass").addEventListener("click", function () {
      load('/$connect?n=' + selObj.value + '&p=' + document.getElementById("conPass").value,
        function () { });
    });

    function cShow(n) {
      var l = document.querySelectorAll("#carousel .item");
      for (i = 0; i <= n; i++)
        l[i].classList.remove('hide');
      for (i = n+1; i < l.length; i++)
        l[i].classList.add('hide');
    };

    // connect using network name and password
    document.getElementById("next1").addEventListener("click", function () {
      cShow(0);
    });

    // connect using network name and password
    document.getElementById("next2").addEventListener("click", function () {
      cShow(1);
    });

    startScan();
  </script>
</body>